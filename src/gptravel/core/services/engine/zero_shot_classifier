import requests
import os
from dotenv import load_dotenv
from typing import Any, Dict, List

load_dotenv()

class ZeroShotClassifier:

    def __init__(self) -> None:
        self._api_token = os.getenv("HUGGING_FACE_KEY")
        self._api_url = "https://api-inference.huggingface.co/models/facebook/bart-large-mnli"

    def _query(self, payload: Dict[str, Any]) -> Dict[str, Any]:
        headers = {"Authorization": f"Bearer {self._api_token}"}
        return requests.post(self._api_url, headers=headers, json=payload).json()
    
    def predict(self, input_text_list: List[str], label_classes: List[str], multi_label: bool = True) -> List[Dict[str, float]]:
        payload = {"inputs": input_text_list,
                   "parameters": {"candidate_labels": label_classes, "multi_label": multi_label}}
        response = self._query(payload=payload)
        return [{label: float(value) for label, value in zip(item["labels"], item["scores"])} for item in response]
